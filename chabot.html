<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>

    <style>
      /* CSS styles for chatApp */
        body{
         font-family: Arial;
         height: 100vh;
         overflow: hidden;
        }

        .appContainer{
          max-width: 600px;
          margin: 0 auto;
          height: 100vh;
          /* background-color: purple; */
          padding-top: 5px;
          text-align: center;
        }

        .input-container {
          display: flex;
        }

        .prompt{
          color: grey;
        }

        .moveText{
          display: flex;
          align-items: center;
          justify-content: center;
          color: rgb(25, 135, 84);
          margin-top: 6px;
          text-decoration: underline;
          cursor: pointer;
        }

        .inputField{
          border: 1px solid grey;
          padding: 13px;
          border-radius: 10px;
          font-size: 16px;
          flex-grow: 1;
        }
        
        .sendButton{
          background-color: rgb(25, 135, 84);
          border: none;
          color: white;
          padding: 13px 20px;
          border-radius: 10px;
          font-size: 16px;
          margin-left: 10px;
        }

        .user-container{
          display: flex;
          justify-content: end;
          align-items: center;
        }

        .robot-container{
          display: flex;
          justify-content: start;
          align-items: center;
          max-width: 350px;
        }

        .messageContainer{
          background-color: rgb(243, 239, 239);
          display: flex;
          align-items: center;
          border-radius: 10px;
          padding: 15px;
          margin: 15px 10px;
        }

        .chatImage{
          width: 45px;
        }

        .chat-message-container{
         height: 82%;
         overflow: scroll;
         scrollbar-width: none;
        }

        /* Styles for spinner */
        /* From Uiverse.io by abrahamcalsin */ 
        .dot-spinner {
          --uib-size: 2.8rem;
          --uib-speed: .9s;
          --uib-color: #183153;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: flex-start;
          height: var(--uib-size);
          width: var(--uib-size);
        }

        .dot-spinner__dot {
          position: absolute;
          top: 0;
          left: 0;
          display: flex;
          align-items: center;
          justify-content: flex-start;
          height: 100%;
          width: 100%;
        }

        .dot-spinner__dot::before {
          content: '';
          height: 20%;
          width: 20%;
          border-radius: 50%;
          background-color: var(--uib-color);
          transform: scale(0);
          opacity: 0.5;
          animation: pulse0112 calc(var(--uib-speed) * 1.111) ease-in-out infinite;
          box-shadow: 0 0 20px rgba(18, 31, 53, 0.3);
        }

        .dot-spinner__dot:nth-child(2) {
          transform: rotate(45deg);
        }

        .dot-spinner__dot:nth-child(2)::before {
          animation-delay: calc(var(--uib-speed) * -0.875);
        }

        .dot-spinner__dot:nth-child(3) {
          transform: rotate(90deg);
        }

        .dot-spinner__dot:nth-child(3)::before {
          animation-delay: calc(var(--uib-speed) * -0.75);
        }

        .dot-spinner__dot:nth-child(4) {
          transform: rotate(135deg);
        }

        .dot-spinner__dot:nth-child(4)::before {
          animation-delay: calc(var(--uib-speed) * -0.625);
        }

        .dot-spinner__dot:nth-child(5) {
          transform: rotate(180deg);
        }

        .dot-spinner__dot:nth-child(5)::before {
          animation-delay: calc(var(--uib-speed) * -0.5);
        }

        .dot-spinner__dot:nth-child(6) {
          transform: rotate(225deg);
        }

        .dot-spinner__dot:nth-child(6)::before {
          animation-delay: calc(var(--uib-speed) * -0.375);
        }

        .dot-spinner__dot:nth-child(7) {
          transform: rotate(270deg);
        }

        .dot-spinner__dot:nth-child(7)::before {
          animation-delay: calc(var(--uib-speed) * -0.25);
        }

        .dot-spinner__dot:nth-child(8) {
          transform: rotate(315deg);
        }

        .dot-spinner__dot:nth-child(8)::before {
          animation-delay: calc(var(--uib-speed) * -0.125);
        }

        @keyframes pulse0112 {
          0%,
          100% {
            transform: scale(0);
            opacity: 0.5;
          }

          50% {
            transform: scale(1);
            opacity: 1;
          }
        }

    </style>

  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script> 

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

      // Input Component
      function ChatInput({ chatMessages, setChatMessage}){

        const [ inputText, setInputText ] = React.useState('');

        function fetchMessage(event){
          setInputText(event.target.value);
        }


        // fetch chatmessage using the spread operator (...) 
        async function sendMessage(){
          const newMessage = [
            ...chatMessages,
            {
              message: inputText,
              sender: 'user',
              id: crypto.randomUUID()
            }
          ]
       
          setChatMessage(newMessage)
          setInputText('');
          setChatMessage([
            ...newMessage,
            {
            message: 'Loading..',
              sender: 'robot',
              id: crypto.randomUUID() 
            }
          ])

          const response = await Chatbot.getResponseAsync(inputText);
            setChatMessage([
              ...newMessage,
              {
                message: response,
                sender: 'robot',
                id: crypto.randomUUID()
              }
            ])
  
        };

        // function to check for the "Enter" key
        function enterKey(event){
          setInputText(event.target.key);

          { event.key === "Enter" ? sendMessage() : '' }
          { event.key === "Escape" ?  setInputText('') : ''}
        }

        const [ content, setContent ] = React.useState('Move textbox to bottom');


        // function to flip the text content below the input field onclick
        function updateContent(){
          setContent ( content === "Move textbox to bottom" ? "Move textbox to top" : "Move textbox to bottom" );
        }

        return(
          <>
            <div className="input-container">
              <input placeholder="Send a message to Chatbot" size="30"
                className="inputField"  
              
                onChange={fetchMessage}
                value={inputText}
                onKeyDown={enterKey}
              />
              <button
                className="sendButton"

                onClick={sendMessage}
              >Send</button>
            </div>
            <div className="moveText">
              <p
               onClick={updateContent}
              >{content}</p>
            </div>
          </>
        )
      }

      // Chat Component
      function ChatMessage({message, sender}){
        return(
          <div className={ sender === "user" ? "user-container" : "robot-container"}>
           {sender === "robot" && (<img className="chatImage" src="robot.png" />)}
            <div className="messageContainer">
              {message}
            </div>
           {sender === "user" && (<img className="chatImage" src="user.png" />)}
          </div>
        )
      }

      // Chat Messages Component
      function ChatMessages({chatMessages}){ 

        const chatMessagesRef = React.useRef(null);

        React.useEffect(() =>{
          const chatMessagesElem = chatMessagesRef.current;

          if(chatMessagesElem){
            chatMessagesElem.scrollTop = chatMessagesElem.scrollHeight;
          }
        }, [chatMessages])

          return(
           <div className="chat-message-container"
            ref={chatMessagesRef}
           >
              {chatMessages.map((chatMessage)=>{
                  return(
                      <ChatMessage 
                        message={chatMessage.message}
                        sender={chatMessage.sender}
                        key={chatMessage.id}
                      />
                    )
              })}
            </div>
          );
      }


      // function MessagePrompt(){

      //   const [ prompt, setPrompt ] = React.useState('Welcome to the chatbot project! Send a message using the textbox below.')

      //   return(
      //     <div className="prompt">
      //       <p>{prompt}</p>
      //     </div> 
      //   )
      // }

      // Main App Component
      function App(){
        // add chatmessage in use state and save usestate in an array variable
        const [ chatMessages, setChatMessage] = React.useState([{
              message: 'hello chatbot',
              sender: 'user',
              id: 'id1'
            }, {
              message: 'Hello! How can I help you?',
              sender: 'robot',
              id: 'id2'
            }, {
              message: 'what is todays date',
              sender: 'user',
              id: 'id3'
            }, {
              message: 'Today is December 15',
              sender: 'robot',
              id: 'id4'
            }]);


        return(
           <div className="appContainer">
            <ChatMessages 
              chatMessages={chatMessages}
            />
            <ChatInput 
               chatMessages={chatMessages}
               setChatMessage={setChatMessage}
            />
           </div>
         );
      }

    //  Render React srcipt
      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />)

    </script>
  </body>
</html>